<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<title>Vehiculos</title>
<head>
	<meta charset="utf-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1"/>
	<link href="favicon.html" rel="icon">
	<link rel="stylesheet" th:href="@{/assets/css/estilos.css}">
	<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/contact-form.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/assets/css/tablas.css}" type="text/css">
	<link rel="stylesheet" th:href="@{/assets/css/nice-select.css}">
	<script src="/SGV/assets/js/jquery-3.4.1.min.js"></script>
	<script src="https://kit.fontawesome.com/4b484f74be.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body th:onload="'Scrol(\''+${Corddocu}+'\',\'' +${Cordtabla}+'\');'">
	<header>
	<div>
		<div class="heades" >
			<img th:src="@{/images/pgj.png}" class="logopgj">
			<div class="dropdown menuGen"  >
				  <a class="btn btn-secondary dropdown-toggle btn-stilo" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				    <i class="fas fa-user-cog"></i>
				  </a>
				
				  <div class="dropdown-menu " aria-labelledby="dropdownMenuLink">
		  			<form th:action="@{/index}" method="post" id="loggout" style="margin-bottom: 3px; margin-left: 5px;">
				        <button class="btn btn-outline-success" onclick="document.getElementById('loggout').submit()" type="submit" style="color:green !important">Cerrar sesion</button>
				    	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
				    </form>	
				    <form  th:action="@{/perfil}" style="margin-bottom: 3px; margin-left: 5px;">
						        <button class="btn btn-outline-success" type="submit" value="enviar" style="color:green !important">Perfil</button>					    	
					</form>
				    <form th:action="@{/Adscripciones}" th:if="${usuario} == 'ROLE_ADMIN' " style="margin-bottom: 3px; margin-left: 5px;">
						        <button class="btn btn-outline-success" type="submit" value="enviar" style="color:green !important">Adscripciones</button>					    	
					</form>
				  </div>
			</div>			
		</div>
		
							
        <div class="TituloCon"></div>
		
		<div class="form-group last col-sm-12 nav-listado">
		
			<a class="btn btn-primary btn-xs col-sm-4 btn-stilo" th:href='@{/home}' style="width: 48px; height: 34px; float: right; margin-right: 5%;margin-top: 5px;"><i class="fas fa-home fa-2x" style="margin-top: 10%;"></i></a>
			<div id="button" class="form-group last col-sm-4" style="margin-bottom: 5px;margin-top: 5px;"> 
				<div class="container" style="width: 314px;">
  							 				 					 			
	 				<div class="dropdown col-sm-4"  >
						  
						  <a class="btn btn-secondary dropdown-toggle btn-stilo" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="background-color: #337ab7;">						   
						  MENU
						  </a>
						
						  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
						  	
						    <form th:action="@{/Viajes}" style="margin-bottom: 3px; margin-left: 5px;" >
						        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Viajes</button>					    	
				    		</form>
				    		<form th:action="@{/Usuarios}" th:if="${usuario} == 'ROLE_ADMIN'" style="margin-bottom: 3px; margin-left: 5px;" >
						        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Usuarios</button>					    	
				    		</form>						    
						    <form th:action="@{/Vehiculos}" style="margin-bottom: 3px; margin-left: 5px;" >
								        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Vehiculo</button>					    	
						    </form>
						     <form th:action="@{/Seguros}" style="margin-bottom: 3px; margin-left: 5px;" >
								        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Seguros</button>					    	
						    </form>
						      <form th:action="@{/Conductores}" style="margin-bottom: 3px; margin-left: 5px;" >
								        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Conductores</button>					    	
						    </form>	
						    <form th:action="@{/Mantenimientos}" style="margin-bottom: 3px; margin-left: 5px;" >
								        <button class="btn btn-outline-success btn-menu" type="submit" value="enviar" >Mantenimiento</button>					    	
						    </form>						 
						   		
						  </div>
					</div>			
 				</div>
 			</div> 			
		</div>
			<div class="titulocontainer">
			<h1 class="item-title text-right StituloCon">Vehiculos</h1>
			</div>
	</div>
	</header>

	
	<section>
	 <div class="tab-content">
	      <div class="form-group last col-sm-12 fondolistado">
	                <div class="row">
	                    <div class="tab-content">
	                        <div class="col-sm-12" >
	                            <div class="item-wrap">
	                                <div class="row" style="text-align: center;">
	                                
	                                		<div class=" col-md-12" id="Contenedorbuscar" >
	                                			<div class="col-md-5" > <p style="text-align: right;">Buscar</p></div> 
	                                			
	                                        	<form id="Busqueda" class="col-md-6" th:action="@{/formVehBuscar}">											       											       
											         <input id="searchTerm" th:value=*{elemento} class="form-control col-md-5" name="elemento" type="text" onkeyup="doSearch()" onkeypress="return pulsar(event)" required="required"/>												           
											           <button type="submit" class="btn btn-primary btn-xs col-sm-3 btn-stilo" style="margin-top: 1%;margin-left: 1%;margin-right: 1%;">Buscar</button>										
											    		<a class="btn btn-primary btn-xs col-sm-4 btn-stilo" th:href='@{/Vehiculos}' style="width: 48px; height: 34px; float: right; margin-right: 5%;margin-top: 5px;"><i class="fas fa-sync-alt fa-2x" style="margin-top: 10%;"></i></a>
											    </form>
											    
											        <div id="coincidencias" class="col-md-8"></div>
											</div>
											
											<div style=" width: 100%;">
												<h2 class="titulotabla" id="autotitulo">Listado de Vehiculos</h2>
												<h2 class="titulotabla" id="blindadotitulo">Listado de Autos Blindados</h2>
												<h2 class="titulotabla" id="mototitulo">Listado de Motos</h2>
												<div class="col-md-6"></div>
												<div class="row justify-content-end  col-md-6">      													
	        										<div class="col-md-1">
													<button class="btn btn-success btn-xs vehiculosselec " id="auto" onclick="auto()"><i class="fas fa-car fa-3x"></i></button>
												    </div>
												    <div class="col-md-1">
												    <button class="btn btn-success btn-xs vehiculosselec " id="blindado" onclick="blindado()"><i class="fas fa-shield-alt fa-3x"></i></button>
												    </div>
												    <div class="col-md-1">
												    <button class="btn btn-success btn-xs vehiculosselec " id="moto" onclick="moto()"><i class="fas fa-motorcycle fa-3x"></i></button>
												    </div>
											    </div>
											</div>
	                                    <div class="col-md-12 table-responsive" id="tableCard">	                                       
										<table class="table table-striped table-bordered fixed_header" id="vehiculosT" style="margin-bottom: 30px">
											<thead>
												<tr>
													<th class="celda">Placa</th>
													<th class="celda">Marca</th>
													<th class="celda">Modelo</th>
													<th class="celda">Año</th>
													<th class="celda">Clase</th>   
													<th class="celda">Tipo</th>
													<th class="celda">No. de Serie</th>
													<th class="celda">No. de Factura</th>
													<th class="celda">Valor Factura</th>
													<th class="celda">Numero de poliza</th>
													<th class="celda">Disponible</th>
													<th class="celda"><i class="fas fa-gas-pump fa-2x"></i></th>
													<th class="celda">Kilometraje</th>
													<th class="celda" style="width: 120px;">Opciones</th>
													<th style="width: 10px;" th:if="${tamano} == 'mostrar'"></th>
													
													<!-- <th>Eliminar</th>
													<th>Asignacion</th>
													<th>Numero unico de Adscripcion</th>-->													
												</tr>
											</thead>
											
											<tbody>												
											
												<tr th:each="vehiculossql: ${vehiculos}">
													<td class="celda" th:text="${vehiculossql.placa}"></td>
													<td class="celda" th:text="${vehiculossql.marca}"></td>
													<td class="celda" th:text="${vehiculossql.modelo}"></td>
													<td class="celda" th:text="${vehiculossql.ano}"></td>
													<td class="celda" th:text="${vehiculossql.clase}"></td>
													<td class="celda" th:text="${vehiculossql.tipo}"></td>
													<td class="celda" th:text="${vehiculossql.no_serie}"></td>
													<td class="celda" th:text="${vehiculossql.no_factura}"></td>
													<td class="celda" th:text="${vehiculossql.valor_factura}"></td>
													<td class="celda" th:text="${vehiculossql.no_poliza}"></td>
													<td class="celda">													
															<a th:id="estadoV+${vehiculossql.placa}" th:if="${vehiculossql.estado} == 'DISPONIBLE'" class="btn btn-success btn-xs Sel" th:href="@{/estadoVehi/} +${vehiculossql.placa}+'/'+${vehiculossql.estado}" onclick="scroller(this.id,'No Disponible');" th:text="SI" style="width: 50px;"></a>
															<a th:id="estadoV+${vehiculossql.placa}" th:if="${vehiculossql.estado} == 'NO DISPONIBLE'" class="btn btn-danger btn-xs Sel" th:href="@{/estadoVehi/} +${vehiculossql.placa}+'/'+${vehiculossql.estado}" onclick="scroller(this.id,'Disponible');" th:text="'No'" style="width: 50px;"></a>														
															<a th:if="${vehiculossql.estado} == 'EN VIAJE'"  th:href="@{/TerminarViaj/} +${vehiculossql.placa}"   class="btn btn-danger btn-xs" onclick="return confirm('¿Deseas entregar el vehiculo y terminar el viaje?')" style="width: 50px;"><i class="fas fa-car-side"></i></a>																													
													</td>
													<td class="celda" th:text="${vehiculossql.tipo_combustible}"></td>
													<td class="celda" th:text="${vehiculossql.kilometraje}"></td>
												<!-- 	<td th:text="${vehiculossql.id_adscripcion}"></td>  -->
													<td style="width: 120px;">
														<div class="nice-select" tabindex="0">
															<span class="current"><i class="fas fa-cogs fa-w-20"></i></span>
															<ul class="list">
																<li th:if="${usuario} == 'ROLE_ADMIN'" data-value="1" class="option "><a class="btn btn-primary btn-xs btn-stilo" th:href="@{/formVehi/} +${vehiculossql.placa}" th:text="editar" style="width: 100px;"></a></li>
																<!--<li th:if="${usuario} == 'ROLE_ADMIN'" data-value="2" class="option"><a class="btn btn-primary btn-xs btn-stilo" th:href="@{/elimVehi/} +${vehiculossql.placa}" onclick="return confirm('Seguro que desea eliminar?');" th:text="eliminar" style="width: 100px;"></a></li>-->
																<li data-value="3" class="option"><a class="btn btn-primary btn-xs btn-stilo" th:href="@{/Combustibles/?placa=} +${vehiculossql.placa}" th:text="Combustible" style="width: 100px;"></a></li>
																<li th:if="${vehiculossql.estado} != 'EN VIAJE'" data-value="4" class="option"><a class="btn btn-primary btn-xs btn-stilo" th:href="@{Mantenimientos/} +${vehiculossql.placa}" th:text="Mantenimiento" style="width: 108px;"></a></li>
																<li th:if="${vehiculossql.estado} == 'DISPONIBLE'" data-value="5" class="option"><a class="btn btn-primary btn-xs btn-stilo" th:href="@{/VehiViaj/} +${vehiculossql.placa}" th:text="'Agregar Viaje'" style="width: 108px;"></a></li>																
															</ul>
														</div>																									  																																																																																																			
													</td>												
												</tr>
											</tbody>
										</table>
										<nav th:replace="paginator-nav :: paginator"></nav>
										
											<div class="form-group last col-sm-12">
											<a class="btn btn-primary btn-xs col-sm-2 btn-stilo" th:href="@{/formVehi}" style="float:right;margin-left: 1%;margin-right: 1%;">Agregar</a>											
											</div>
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
			</div>
			
		</div>
	</section>
	<script type="text/javascript"  th:inline="javascript">
	
	function auto(){
	   	 $("#auto").prop('disabled', true);
	   	 $("#blindado").prop('disabled', false);
	   	 $("#moto").prop('disabled', false);
	   	$("#autotitulo").show();
	   	$("#blindadotitulo").hide();
	   	$("#mototitulo").hide();
	   	
	   }
	
	function blindado(){   	 
	   $("#auto").prop('disabled', false);
	  	 $("#blindado").prop('disabled', true);
	  	 $("#moto").prop('disabled', false);
	  	$("#autotitulo").hide();
	   	$("#blindadotitulo").show();
	   	$("#mototitulo").hide();
	  }
	
	function moto(){  
	   $("#auto").prop('disabled', false);
	  	 $("#blindado").prop('disabled', false);
	  	 $("#moto").prop('disabled', true);
	  	$("#autotitulo").hide();
	   	$("#blindadotitulo").hide();
	   	$("#mototitulo").show();
	  }
	
	
	function doSearch()

    {

        const tableReg = document.getElementById('vehiculosT');

        const searchText = document.getElementById('searchTerm').value.toLowerCase();

        let total = 0;

        // Recorremos todas las filas con contenido de la tabla
       

	        for (let i = 1; i < tableReg.rows.length; i++) {
	
	            // Si el td tiene la clase "noSearch" no se busca en su cntenido
	
	            if (tableReg.rows[i].classList.contains("noSearch")) {
	                continue;
	            }
	
	            let found = false;
	
	            const cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
	
	            // Recorremos todas las celdas
	
	            for (let j = 0; j < cellsOfRow.length && !found; j++) {
	
	                const compareWith = cellsOfRow[j].innerHTML.toLowerCase();
	
	                // Buscamos el texto en el contenido de la celda
	
	                if (searchText.length == 0 || compareWith.indexOf(searchText) > -1) {
	
	                    found = true;
	
	                    total++;
	                }
	            }
	
	            if (found) {
	
	                tableReg.rows[i].style.display = '';
	
	            } else {
	
	                // si no ha encontrado ninguna coincidencia, esconde la
	
	                // fila de la tabla
	
	                tableReg.rows[i].style.display = 'none';
	           }
	        }
	
	        // mostramos las coincidencias
	
	        const lastTR=tableReg.rows[tableReg.rows.length-1];
	
	        const td=lastTR.querySelector("td");
	
	        lastTR.classList.remove("hide", "red");
	
	        if (searchText == "") {
	
	            //lastTR.classList.add("hide");
	            $('#coincidencias').html("");
	        } else if (total) {
	        	$('#coincidencias').html("Se ha encontrado "+total+" coincidencia"+((total>1)?"s":""));
	           // td.innerHTML="Se ha encontrado "+total+" coincidencia"+((total>1)?"s":"");
	
	        } else {
	
	            lastTR.classList.add("red");
	            $('#coincidencias').html("No se han encontrado coincidencias")
	            //td.innerHTML="No se han encontrado coincidencias";
	        }
        
    }
    
    function pulsar(e) {
    	  tecla = (document.all) ? e.keyCode :e.which;
    	  return (tecla!=13);
    	} 
		    
    
    function Scrol(documento, tabla){
      	 $(document).scrollTop(documento);
      	 $(".fixed_header tbody").scrollTop(tabla);
      		$("#auto").prop('disabled', true);
   		$("#blindado").prop('disabled', false);
   		$("#moto").prop('disabled', false);
   		
   	 	$("#autotitulo").show();
   	   	$("#blindadotitulo").hide();
   	   	$("#mototitulo").hide();	
      }
      function scroller(id){
      	//alert("id: "+ id);
      	var corDocument = $(document).scrollTop();	
   		var corElement = $(".fixed_header tbody").scrollTop();
   		var direccion = $("#"+id).attr("href");
   		var pagina= getUrlParameter('page')	
   		if(pagina==null){pagina=0;}
   		var Redirigir=direccion+"/"+ corDocument +"/"+corElement+"?page="+pagina;
   		$("#"+id).attr('href',Redirigir);

   		 var opcion = confirm("Seguro que desea cambiar el estado del vehiculo?");
   		    if (opcion == true) {
   		    	//alert("link "+$("#"+id).attr('href'));		    	
   		    	location.href = $("#"+id).attr('href');
   			} else {
   			    return false;
   			}
      }
      
      var getUrlParameter = function getUrlParameter(sParam) {
   	    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
   	        sURLVariables = sPageURL.split('&'),
   	        sParameterName,
   	        i;

   	    for (i = 0; i < sURLVariables.length; i++) {
   	        sParameterName = sURLVariables[i].split('=');

   	        if (sParameterName[0] === sParam) {
   	            return sParameterName[1] === undefined ? true : sParameterName[1];
   	        }
   	    }
   	};
    $('.Sel').click(function(event) {
        event.preventDefault();
     });
    </script>   
     <script src="/SGV/assets/js/CambiosEstado.js"></script>
    <!-- api nice-select -->
    <script src="/SGV/assets/js/jquery.js"></script> 
	<script src="/SGV/assets/js/jquery.nice-select.js"></script>
	<!-- jQuery Library 
	<script src="/SGV/assets/js/jquery-3.4.1.min.js"></script>-->
	<!-- Popper js -->
	<script src="/SGV/assets/js/popper.min.js"></script>
	<!-- Bootstrap Js -->
	<script src="/SGV/assets/js/bootstrap.min.js"></script>
	<!-- Form Validator -->
	<script src="/SGV/assets/js/validator.min.js"></script>
	<!-- Contact Form Js -->
	<script src="/SGV/assets/js/contact-form.js"></script>
 	 <script>
    $(document).ready(function() {
      $('select:not(.ignore)').niceSelect();      
      //FastClick.attach(document.body);
      	
    });
           
    </script>
</body>
</html>
